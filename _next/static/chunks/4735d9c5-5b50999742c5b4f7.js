"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[20],{50779:function(e,t,r){var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(n,s){function o(e){try{c(a.next(e))}catch(t){s(t)}}function i(e){try{c(a.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}c((a=a.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,a,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(n=2&s[0]?a.return:s[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,s[1])).done)return n;switch(a=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,a=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(i){s=[6,i],a=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},o=this&&this.__spreadArray||function(e,t){for(var r=0,a=t.length,n=e.length;r<a;r++,n++)e[n]=t[r];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenSeaPort=void 0;var i=r(44431),c=r(21964),d=r(89766),u=r(96486),l=r(8272),h=r(25655),m=r(9201),p=r(68250),y=r(8195),v=r(4500),A=r(97524),f=r(34063),g=r(58183),_=r(86050),w=function(){function e(e,t,r){var a;void 0===t&&(t={}),this.gasPriceAddition=new i.BigNumber(3),this.gasIncreaseFactor=y.DEFAULT_GAS_INCREASE_FACTOR,t.networkName=t.networkName||f.Network.Main,t.gasPrice=t.gasPrice,this.api=new p.OpenSeaAPI(t),this._networkName=t.networkName;var n=new l.providers.HttpProvider(this.api.apiBaseUrl+"/"+y.RPC_URL_PATH),s=null===(a=t.useReadOnlyProvider)||void 0===a||a;this.web3=new l(e),this.web3ReadOnly=s?new l(n):this.web3,this._wyvernProtocol=new h.WyvernProtocol(e,{network:this._networkName}),this._wyvernProtocolReadOnly=s?new h.WyvernProtocol(n,{network:this._networkName}):this._wyvernProtocol,this._wrappedNFTFactoryAddress=this._networkName==f.Network.Main?y.WRAPPED_NFT_FACTORY_ADDRESS_MAINNET:y.WRAPPED_NFT_FACTORY_ADDRESS_RINKEBY,this._wrappedNFTLiquidationProxyAddress=this._networkName==f.Network.Main?y.WRAPPED_NFT_LIQUIDATION_PROXY_ADDRESS_MAINNET:y.WRAPPED_NFT_LIQUIDATION_PROXY_ADDRESS_RINKEBY,this._uniswapFactoryAddress=this._networkName==f.Network.Main?y.UNISWAP_FACTORY_ADDRESS_MAINNET:y.UNISWAP_FACTORY_ADDRESS_RINKEBY,this._emitter=new d.EventEmitter,this.logger=r||function(e){return e}}return e.prototype.addListener=function(e,t,r){return void 0===r&&(r=!1),r?this._emitter.once(e,t):this._emitter.addListener(e,t)},e.prototype.removeListener=function(e){e.remove()},e.prototype.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},e.prototype.wrapAssets=function(e){var t=e.assets,r=e.accountAddress;return n(this,void 0,void 0,(function(){var e,a,n,o,i,c,d=this;return s(this,(function(s){switch(s.label){case 0:return e=this._getSchema(f.WyvernSchemaName.ERC721),a=t.map((function(t){return _.getWyvernAsset(e,t)})),n=a.map((function(e){return e.id})),o=a.map((function(e){return e.address})),i=!o.every((function(e,t,r){return e===r[0]})),this._dispatch(f.EventType.WrapAssets,{assets:a,accountAddress:r}),[4,_.sendRawTransaction(this.web3,{from:r,to:this._wrappedNFTLiquidationProxyAddress,value:0,data:g.encodeCall(v.getMethod(v.WrappedNFTLiquidationProxy,"wrapNFTs"),[n,o,i])},(function(e){d._dispatch(f.EventType.TransactionDenied,{error:e,accountAddress:r})}))];case 1:return c=s.sent(),[4,this._confirmTransaction(c,f.EventType.WrapAssets,"Wrapping Assets")];case 2:return s.sent(),[2]}}))}))},e.prototype.unwrapAssets=function(e){var t=e.assets,r=e.destinationAddresses,a=e.accountAddress;return n(this,void 0,void 0,(function(){var e,n,o,i,c,d,u=this;return s(this,(function(s){switch(s.label){case 0:if(!t||!r||t.length!=r.length)throw new Error("The 'assets' and 'destinationAddresses' arrays must exist and have the same length.");return e=this._getSchema(f.WyvernSchemaName.ERC721),n=t.map((function(t){return _.getWyvernAsset(e,t)})),o=n.map((function(e){return e.id})),i=n.map((function(e){return e.address})),c=!i.every((function(e,t,r){return e===r[0]})),this._dispatch(f.EventType.UnwrapAssets,{assets:n,accountAddress:a}),[4,_.sendRawTransaction(this.web3,{from:a,to:this._wrappedNFTLiquidationProxyAddress,value:0,data:g.encodeCall(v.getMethod(v.WrappedNFTLiquidationProxy,"unwrapNFTs"),[o,i,r,c])},(function(e){u._dispatch(f.EventType.TransactionDenied,{error:e,accountAddress:a})}))];case 1:return d=s.sent(),[4,this._confirmTransaction(d,f.EventType.UnwrapAssets,"Unwrapping Assets")];case 2:return s.sent(),[2]}}))}))},e.prototype.liquidateAssets=function(e){var t=e.assets,r=e.accountAddress,a=e.uniswapSlippageAllowedInBasisPoints;return n(this,void 0,void 0,(function(){var e,n,o,i,c,d,u,l=this;return s(this,(function(s){switch(s.label){case 0:return e=0===a?y.DEFAULT_WRAPPED_NFT_LIQUIDATION_UNISWAP_SLIPPAGE_IN_BASIS_POINTS:a,n=this._getSchema(f.WyvernSchemaName.ERC721),o=t.map((function(e){return _.getWyvernAsset(n,e)})),i=o.map((function(e){return e.id})),c=o.map((function(e){return e.address})),d=!c.every((function(e,t,r){return e===r[0]})),this._dispatch(f.EventType.LiquidateAssets,{assets:o,accountAddress:r}),[4,_.sendRawTransaction(this.web3,{from:r,to:this._wrappedNFTLiquidationProxyAddress,value:0,data:g.encodeCall(v.getMethod(v.WrappedNFTLiquidationProxy,"liquidateNFTs"),[i,c,d,e])},(function(e){l._dispatch(f.EventType.TransactionDenied,{error:e,accountAddress:r})}))];case 1:return u=s.sent(),[4,this._confirmTransaction(u,f.EventType.LiquidateAssets,"Liquidating Assets")];case 2:return s.sent(),[2]}}))}))},e.prototype.purchaseAssets=function(e){var t=e.numTokensToBuy,r=e.amount,a=e.contractAddress,o=e.accountAddress;return n(this,void 0,void 0,(function(){var e,n=this;return s(this,(function(s){switch(s.label){case 0:return m.tokens[this._networkName].canonicalWrappedEther,this._dispatch(f.EventType.PurchaseAssets,{amount:r,contractAddress:a,accountAddress:o}),[4,_.sendRawTransaction(this.web3,{from:o,to:this._wrappedNFTLiquidationProxyAddress,value:r,data:g.encodeCall(v.getMethod(v.WrappedNFTLiquidationProxy,"purchaseNFTs"),[t,a])},(function(e){n._dispatch(f.EventType.TransactionDenied,{error:e,accountAddress:o})}))];case 1:return e=s.sent(),[4,this._confirmTransaction(e,f.EventType.PurchaseAssets,"Purchasing Assets")];case 2:return s.sent(),[2]}}))}))},e.prototype.getQuoteFromUniswap=function(e){var t=e.numTokens,r=e.isBuying,a=e.contractAddress;return n(this,void 0,void 0,(function(){var e,n,o,i,c,d,u;return s(this,(function(s){switch(s.label){case 0:return[4,this.web3.eth.contract(v.WrappedNFTFactory).at(this._wrappedNFTFactoryAddress)];case 1:return[4,s.sent().nftContractToWrapperContract(a)];case 2:return e=s.sent(),[4,this.web3.eth.contract(v.WrappedNFT).at(e)];case 3:return n=s.sent(),[4,this.web3.eth.contract(v.UniswapFactory).at(this._uniswapFactoryAddress)];case 4:return[4,s.sent().getExchange(e)];case 5:return o=s.sent(),[4,this.web3.eth.contract(v.UniswapExchange).at(o)];case 6:return i=s.sent(),c=h.WyvernProtocol.toBaseUnitAmount(_.makeBigNumber(t),n.decimals()),r?(d=parseInt,[4,i.getEthToTokenOutputPrice(c)]):[3,8];case 7:return[2,d.apply(void 0,[s.sent()])];case 8:return u=parseInt,[4,i.getTokenToEthInputPrice(c)];case 9:return[2,u.apply(void 0,[s.sent()])]}}))}))},e.prototype.wrapEth=function(e){var t=e.amountInEth,r=e.accountAddress;return n(this,void 0,void 0,(function(){var e,a,n,o=this;return s(this,(function(s){switch(s.label){case 0:return e=m.tokens[this._networkName].canonicalWrappedEther,a=h.WyvernProtocol.toBaseUnitAmount(_.makeBigNumber(t),e.decimals),this._dispatch(f.EventType.WrapEth,{accountAddress:r,amount:a}),[4,_.sendRawTransaction(this.web3,{from:r,to:e.address,value:a,data:g.encodeCall(v.getMethod(v.CanonicalWETH,"deposit"),[])},(function(e){o._dispatch(f.EventType.TransactionDenied,{error:e,accountAddress:r})}))];case 1:return n=s.sent(),[4,this._confirmTransaction(n,f.EventType.WrapEth,"Wrapping ETH")];case 2:return s.sent(),[2]}}))}))},e.prototype.unwrapWeth=function(e){var t=e.amountInEth,r=e.accountAddress;return n(this,void 0,void 0,(function(){var e,a,n,o=this;return s(this,(function(s){switch(s.label){case 0:return e=m.tokens[this._networkName].canonicalWrappedEther,a=h.WyvernProtocol.toBaseUnitAmount(_.makeBigNumber(t),e.decimals),this._dispatch(f.EventType.UnwrapWeth,{accountAddress:r,amount:a}),[4,_.sendRawTransaction(this.web3,{from:r,to:e.address,value:0,data:g.encodeCall(v.getMethod(v.CanonicalWETH,"withdraw"),[a.toString()])},(function(e){o._dispatch(f.EventType.TransactionDenied,{error:e,accountAddress:r})}))];case 1:return n=s.sent(),[4,this._confirmTransaction(n,f.EventType.UnwrapWeth,"Unwrapping W-ETH")];case 2:return s.sent(),[2]}}))}))},e.prototype.createBundleBuyOrder=function(e){var t=e.assets,r=e.collection,o=e.quantities,i=e.accountAddress,c=e.startAmount,d=e.expirationTime,u=void 0===d?0:d,l=e.paymentTokenAddress,h=e.sellOrder,p=e.referrerAddress;return n(this,void 0,void 0,(function(){var e,n,d,y,v;return s(this,(function(s){switch(s.label){case 0:return o=o||t.map((function(e){return 1})),l=l||m.tokens[this._networkName].canonicalWrappedEther.address,[4,this._makeBundleBuyOrder({assets:t,collection:r,quantities:o,accountAddress:i,startAmount:c,expirationTime:u,paymentTokenAddress:l,extraBountyBasisPoints:0,sellOrder:h,referrerAddress:p})];case 1:return e=s.sent(),[4,this._buyOrderValidationAndApprovals({order:e,accountAddress:i})];case 2:s.sent(),n=a(a({},e),{hash:_.getOrderHash(e)}),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,this._authorizeOrder(n)];case 4:return d=s.sent(),[3,6];case 5:throw y=s.sent(),console.error(y),new Error("You declined to authorize your offer");case 6:return v=a(a({},n),d),[2,this.validateAndPostOrder(v)]}}))}))},e.prototype.createBuyOrder=function(e){var t=e.asset,r=e.accountAddress,o=e.startAmount,i=e.quantity,c=void 0===i?1:i,d=e.expirationTime,u=void 0===d?0:d,l=e.paymentTokenAddress,h=e.sellOrder,p=e.referrerAddress;return n(this,void 0,void 0,(function(){var e,n,i,d,y;return s(this,(function(s){switch(s.label){case 0:return l=l||m.tokens[this._networkName].canonicalWrappedEther.address,[4,this._makeBuyOrder({asset:t,quantity:c,accountAddress:r,startAmount:o,expirationTime:u,paymentTokenAddress:l,extraBountyBasisPoints:0,sellOrder:h,referrerAddress:p})];case 1:return e=s.sent(),[4,this._buyOrderValidationAndApprovals({order:e,accountAddress:r})];case 2:s.sent(),n=a(a({},e),{hash:_.getOrderHash(e)}),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,this._authorizeOrder(n)];case 4:return i=s.sent(),[3,6];case 5:throw d=s.sent(),console.error(d),new Error("You declined to authorize your offer");case 6:return y=a(a({},n),i),[2,this.validateAndPostOrder(y)]}}))}))},e.prototype.createSellOrder=function(e){var t=e.asset,r=e.accountAddress,o=e.startAmount,i=e.endAmount,c=e.quantity,d=void 0===c?1:c,u=e.listingTime,l=e.expirationTime,h=void 0===l?0:l,m=e.waitForHighestBid,p=void 0!==m&&m,v=e.englishAuctionReservePrice,A=e.paymentTokenAddress,f=e.extraBountyBasisPoints,g=void 0===f?0:f,w=e.buyerAddress,T=e.buyerEmail;return n(this,void 0,void 0,(function(){var e,n,c,l,m;return s(this,(function(s){switch(s.label){case 0:return[4,this._makeSellOrder({asset:t,quantity:d,accountAddress:r,startAmount:o,endAmount:i,listingTime:u,expirationTime:h,waitForHighestBid:p,englishAuctionReservePrice:v,paymentTokenAddress:A||y.NULL_ADDRESS,extraBountyBasisPoints:g,buyerAddress:w||y.NULL_ADDRESS})];case 1:return e=s.sent(),[4,this._sellOrderValidationAndApprovals({order:e,accountAddress:r})];case 2:return s.sent(),T?[4,this._createEmailWhitelistEntry({order:e,buyerEmail:T})]:[3,4];case 3:s.sent(),s.label=4;case 4:n=a(a({},e),{hash:_.getOrderHash(e)}),s.label=5;case 5:return s.trys.push([5,7,,8]),[4,this._authorizeOrder(n)];case 6:return c=s.sent(),[3,8];case 7:throw l=s.sent(),console.error(l),new Error("You declined to authorize your auction");case 8:return m=a(a({},n),c),[2,this.validateAndPostOrder(m)]}}))}))},e.prototype.createFactorySellOrders=function(e){var t=e.assets,r=e.accountAddress,o=e.startAmount,i=e.endAmount,c=e.quantity,d=void 0===c?1:c,l=e.listingTime,h=e.expirationTime,m=void 0===h?0:h,p=e.waitForHighestBid,v=void 0!==p&&p,A=e.paymentTokenAddress,f=e.extraBountyBasisPoints,g=void 0===f?0:f,w=e.buyerAddress,T=e.buyerEmail,k=e.numberOfOrders,E=void 0===k?1:k;return n(this,void 0,void 0,(function(){var e,c,h,p,f,k,b,P,S,N=this;return s(this,(function(F){switch(F.label){case 0:if(E<1)throw new Error("Need to make at least one sell order");if(!t||!t.length)throw new Error("Need at least one asset to create orders for");if(1!==u.uniqBy(t,(function(e){return e.tokenAddress})).length)throw new Error("All assets must be on the same factory contract address");return[4,this._makeSellOrder({asset:t[0],quantity:d,accountAddress:r,startAmount:o,endAmount:i,listingTime:l,expirationTime:m,waitForHighestBid:v,paymentTokenAddress:A||y.NULL_ADDRESS,extraBountyBasisPoints:g,buyerAddress:w||y.NULL_ADDRESS})];case 1:return e=F.sent(),[4,this._sellOrderValidationAndApprovals({order:e,accountAddress:r})];case 2:F.sent(),c=function(e){return n(N,void 0,void 0,(function(){var t,n,c,u,h;return s(this,(function(s){switch(s.label){case 0:return[4,this._makeSellOrder({asset:e,quantity:d,accountAddress:r,startAmount:o,endAmount:i,listingTime:l,expirationTime:m,waitForHighestBid:v,paymentTokenAddress:A||y.NULL_ADDRESS,extraBountyBasisPoints:g,buyerAddress:w||y.NULL_ADDRESS})];case 1:return t=s.sent(),T?[4,this._createEmailWhitelistEntry({order:t,buyerEmail:T})]:[3,3];case 2:s.sent(),s.label=3;case 3:n=a(a({},t),{hash:_.getOrderHash(t)}),s.label=4;case 4:return s.trys.push([4,6,,7]),[4,this._authorizeOrder(n)];case 5:return c=s.sent(),[3,7];case 6:throw u=s.sent(),console.error(u),new Error("You declined to authorize your auction, or your web3 provider can't sign using personal_sign. Try 'web3-provider-engine' and make sure a mnemonic is set. Just a reminder: there's no gas needed anymore to mint tokens!");case 7:return h=a(a({},n),c),[2,this.validateAndPostOrder(h)]}}))}))},h=u.range(E*t.length),p=u.chunk(h,y.SELL_ORDER_BATCH_SIZE),f=0,k=0,b=p,F.label=3;case 3:return k<b.length?(P=b[k],[4,Promise.all(P.map((function(e){return n(N,void 0,void 0,(function(){var r;return s(this,(function(a){return r=Math.floor(e/E),[2,c(t[r])]}))}))})))]):[3,7];case 4:return S=F.sent(),this.logger("Created and posted a batch of "+S.length+" orders in parallel."),f+=S.length,[4,_.delay(500)];case 5:F.sent(),F.label=6;case 6:return k++,[3,3];case 7:return[2,f]}}))}))},e.prototype.createBundleSellOrder=function(e){var t=e.bundleName,r=e.bundleDescription,o=e.bundleExternalLink,i=e.assets,c=e.collection,d=e.quantities,u=e.accountAddress,l=e.startAmount,h=e.endAmount,m=e.expirationTime,p=void 0===m?0:m,v=e.listingTime,A=e.waitForHighestBid,f=void 0!==A&&A,g=e.englishAuctionReservePrice,w=e.paymentTokenAddress,T=e.extraBountyBasisPoints,k=void 0===T?0:T,E=e.buyerAddress;return n(this,void 0,void 0,(function(){var e,n,m,A,T;return s(this,(function(s){switch(s.label){case 0:return d=d||i.map((function(e){return 1})),[4,this._makeBundleSellOrder({bundleName:t,bundleDescription:r,bundleExternalLink:o,assets:i,collection:c,quantities:d,accountAddress:u,startAmount:l,endAmount:h,listingTime:v,expirationTime:p,waitForHighestBid:f,englishAuctionReservePrice:g,paymentTokenAddress:w||y.NULL_ADDRESS,extraBountyBasisPoints:k,buyerAddress:E||y.NULL_ADDRESS})];case 1:return e=s.sent(),[4,this._sellOrderValidationAndApprovals({order:e,accountAddress:u})];case 2:s.sent(),n=a(a({},e),{hash:_.getOrderHash(e)}),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,this._authorizeOrder(n)];case 4:return m=s.sent(),[3,6];case 5:throw A=s.sent(),console.error(A),new Error("You declined to authorize your auction");case 6:return T=a(a({},n),m),[2,this.validateAndPostOrder(T)]}}))}))},e.prototype.fulfillOrder=function(e){var t=e.order,r=e.accountAddress,a=e.recipientAddress,o=e.referrerAddress;return n(this,void 0,void 0,(function(){var e,i,c,d,u,l,h=this;return s(this,(function(m){switch(m.label){case 0:return e=this._makeMatchingOrder({order:t,accountAddress:r,recipientAddress:a||r}),i=_.assignOrdersToSides(t,e),c=i.buy,d=i.sell,u=this._getMetadata(t,o),[4,this._atomicMatch({buy:c,sell:d,accountAddress:r,metadata:u})];case 1:return l=m.sent(),[4,this._confirmTransaction(l,f.EventType.MatchOrders,"Fulfilling order",(function(){return n(h,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._validateOrder(t)];case 1:return[2,!e.sent()]}}))}))}))];case 2:return m.sent(),[2,l]}}))}))},e.prototype.cancelOrder=function(e){var t=e.order,r=e.accountAddress;return n(this,void 0,void 0,(function(){var e,a=this;return s(this,(function(o){switch(o.label){case 0:return this._dispatch(f.EventType.CancelOrder,{order:t,accountAddress:r}),[4,this._wyvernProtocol.wyvernExchange.cancelOrder_.sendTransactionAsync([t.exchange,t.maker,t.taker,t.feeRecipient,t.target,t.staticTarget,t.paymentToken],[t.makerRelayerFee,t.takerRelayerFee,t.makerProtocolFee,t.takerProtocolFee,t.basePrice,t.extra,t.listingTime,t.expirationTime,t.salt],t.feeMethod,t.side,t.saleKind,t.howToCall,t.calldata,t.replacementPattern,t.staticExtradata,t.v||0,t.r||y.NULL_BLOCK_HASH,t.s||y.NULL_BLOCK_HASH,{from:r})];case 1:return e=o.sent(),[4,this._confirmTransaction(e.toString(),f.EventType.CancelOrder,"Cancelling order",(function(){return n(a,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._validateOrder(t)];case 1:return[2,!e.sent()]}}))}))}))];case 2:return o.sent(),[2]}}))}))},e.prototype.approveSemiOrNonFungibleToken=function(e){var t=e.tokenId,r=e.tokenAddress,a=e.accountAddress,o=e.proxyAddress,i=e.tokenAbi,c=void 0===i?v.ERC721:i,d=e.skipApproveAllIfTokenAddressIn,u=void 0===d?new Set:d,l=e.schemaName,h=void 0===l?f.WyvernSchemaName.ERC721:l;return n(this,void 0,void 0,(function(){var e,i,d,l,m,p,y,v,A=this;return s(this,(function(g){switch(g.label){case 0:return e=this._getSchema(h),[4,this.web3.eth.contract(c).at(r)];case 1:return i=g.sent(),o?[3,3]:[4,this._getProxy(a)];case 2:if(!(o=g.sent()||void 0))throw new Error("Uninitialized account");g.label=3;case 3:return[4,(d=function(){return n(A,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,_.rawCall(this.web3ReadOnly,{from:a,to:i.address,data:i.isApprovedForAll.getData(a,o)})];case 1:return e=t.sent(),[2,parseInt(e)]}}))}))})()];case 4:if(1==(l=g.sent()))return this.logger("Already approved proxy for all tokens"),[2,null];if(0!=l)return[3,9];if(u.has(r))return this.logger("Already approving proxy for all tokens in another transaction"),[2,null];u.add(r),g.label=5;case 5:return g.trys.push([5,8,,9]),this._dispatch(f.EventType.ApproveAllAssets,{accountAddress:a,proxyAddress:o,contractAddress:r}),[4,_.sendRawTransaction(this.web3,{from:a,to:i.address,data:i.setApprovalForAll.getData(o,!0)},(function(e){A._dispatch(f.EventType.TransactionDenied,{error:e,accountAddress:a})}))];case 6:return y=g.sent(),[4,this._confirmTransaction(y,f.EventType.ApproveAllAssets,"Approving all tokens of this type for trading",(function(){return n(A,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,d()];case 1:return[2,1==e.sent()]}}))}))}))];case 7:return g.sent(),[2,y];case 8:throw m=g.sent(),console.error(m),new Error("Couldn't get permission to approve these tokens for trading. Their contract might not be implemented correctly. Please contact the developer!");case 9:return this.logger("Contract does not support Approve All"),[4,(p=function(){return n(A,void 0,void 0,(function(){var e;return s(this,(function(r){switch(r.label){case 0:return[4,_.promisifyCall((function(e){return i.getApproved.call(t,e)}))];case 1:return(e=r.sent())==o?(this.logger("Already approved proxy for this token"),[2,!0]):(this.logger("Approve response: "+e),e?[3,3]:[4,_.getNonCompliantApprovalAddress(i,t,a)]);case 2:if((e=r.sent())==o)return this.logger("Already approved proxy for this item"),[2,!0];this.logger("Special-case approve response: "+e),r.label=3;case 3:return[2,!1]}}))}))})()];case 10:if(g.sent())return[2,null];g.label=11;case 11:return g.trys.push([11,14,,15]),this._dispatch(f.EventType.ApproveAsset,{accountAddress:a,proxyAddress:o,asset:_.getWyvernAsset(e,{tokenId:t,tokenAddress:r})}),[4,_.sendRawTransaction(this.web3,{from:a,to:i.address,data:i.approve.getData(o,t)},(function(e){A._dispatch(f.EventType.TransactionDenied,{error:e,accountAddress:a})}))];case 12:return y=g.sent(),[4,this._confirmTransaction(y,f.EventType.ApproveAsset,"Approving single token for trading",p)];case 13:return g.sent(),[2,y];case 14:throw v=g.sent(),console.error(v),new Error("Couldn't get permission to approve this token for trading. Its contract might not be implemented correctly. Please contact the developer!");case 15:return[2]}}))}))},e.prototype.approveFungibleToken=function(e){var t=e.accountAddress,r=e.tokenAddress,a=e.proxyAddress,o=e.minimumAmount,i=void 0===o?h.WyvernProtocol.MAX_UINT_256:o;return n(this,void 0,void 0,(function(){var e,o,c,d=this;return s(this,(function(u){switch(u.label){case 0:return a=a||h.WyvernProtocol.getTokenTransferProxyAddress(this._networkName),[4,this._getApprovedTokenCount({accountAddress:t,tokenAddress:r,proxyAddress:a})];case 1:return(e=u.sent()).greaterThanOrEqualTo(i)?(this.logger("Already approved enough currency for trading"),[2,null]):(this.logger("Not enough token approved for trade: "+e+" approved to transfer "+r),this._dispatch(f.EventType.ApproveCurrency,{accountAddress:t,contractAddress:r,proxyAddress:a}),o=[y.ENJIN_COIN_ADDRESS,y.MANA_ADDRESS].includes(r.toLowerCase()),i.greaterThan(0)&&o?[4,this.unapproveFungibleToken({accountAddress:t,tokenAddress:r,proxyAddress:a})]:[3,3]);case 2:u.sent(),u.label=3;case 3:return[4,_.sendRawTransaction(this.web3,{from:t,to:r,data:g.encodeCall(v.getMethod(v.ERC20,"approve"),[a,h.WyvernProtocol.MAX_UINT_256.toString()])},(function(e){d._dispatch(f.EventType.TransactionDenied,{error:e,accountAddress:t})}))];case 4:return c=u.sent(),[4,this._confirmTransaction(c,f.EventType.ApproveCurrency,"Approving currency for trading",(function(){return n(d,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._getApprovedTokenCount({accountAddress:t,tokenAddress:r,proxyAddress:a})];case 1:return[2,e.sent().greaterThanOrEqualTo(i)]}}))}))}))];case 5:return u.sent(),[2,c]}}))}))},e.prototype.unapproveFungibleToken=function(e){var t=e.accountAddress,r=e.tokenAddress,a=e.proxyAddress;return n(this,void 0,void 0,(function(){var e,o=this;return s(this,(function(i){switch(i.label){case 0:return a=a||h.WyvernProtocol.getTokenTransferProxyAddress(this._networkName),[4,_.sendRawTransaction(this.web3,{from:t,to:r,data:g.encodeCall(v.getMethod(v.ERC20,"approve"),[a,0])},(function(e){o._dispatch(f.EventType.TransactionDenied,{error:e,accountAddress:t})}))];case 1:return e=i.sent(),[4,this._confirmTransaction(e,f.EventType.UnapproveCurrency,"Resetting Currency Approval",(function(){return n(o,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._getApprovedTokenCount({accountAddress:t,tokenAddress:r,proxyAddress:a})];case 1:return[2,e.sent().isZero()]}}))}))}))];case 2:return i.sent(),[2,e]}}))}))},e.prototype.getCurrentPrice=function(e){return n(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._wyvernProtocolReadOnly.wyvernExchange.calculateCurrentPrice_.callAsync([e.exchange,e.maker,e.taker,e.feeRecipient,e.target,e.staticTarget,e.paymentToken],[e.makerRelayerFee,e.takerRelayerFee,e.makerProtocolFee,e.takerProtocolFee,e.basePrice,e.extra,e.listingTime,e.expirationTime,e.salt],e.feeMethod,e.side,e.saleKind,e.howToCall,e.calldata,e.replacementPattern,e.staticExtradata)];case 1:return[2,t.sent()]}}))}))},e.prototype.isOrderFulfillable=function(e){var t=e.order,r=e.accountAddress,a=e.recipientAddress,o=e.referrerAddress;return n(this,void 0,void 0,(function(){var e,n,i,c,d,u;return s(this,(function(s){switch(s.label){case 0:return e=this._makeMatchingOrder({order:t,accountAddress:r,recipientAddress:a||r}),n=_.assignOrdersToSides(t,e),i=n.buy,c=n.sell,d=this._getMetadata(t,o),[4,this._estimateGasForMatch({buy:i,sell:c,accountAddress:r,metadata:d})];case 1:return u=s.sent(),this.logger("Gas estimate for "+(t.side==f.OrderSide.Sell?"sell":"buy")+" order: "+u),[2,null!=u&&u>0]}}))}))},e.prototype.isAssetTransferrable=function(e,t){var r=e.asset,a=e.fromAddress,o=e.toAddress,i=e.quantity,c=e.useProxy,d=void 0!==c&&c;return void 0===t&&(t=1),n(this,void 0,void 0,(function(){var e,n,c,u,l,m,p,y;return s(this,(function(s){switch(s.label){case 0:return e=this._getSchema(r.schemaName),n=i?h.WyvernProtocol.toBaseUnitAmount(_.makeBigNumber(i),r.decimals||0):_.makeBigNumber(1),c=_.getWyvernAsset(e,r,n),u=e.functions.transfer(c),l=a,d?[4,this._getProxy(a)]:[3,2];case 1:if(!(m=s.sent()))return console.error("This asset's owner ("+a+") does not have a proxy!"),[2,!1];l=m,s.label=2;case 2:p=g.encodeTransferCall(u,a,o),s.label=3;case 3:return s.trys.push([3,5,,8]),[4,_.estimateGas(this._getClientsForRead(t).web3,{from:l,to:u.target,data:p})];case 4:return[2,s.sent()>0];case 5:return y=s.sent(),t<=0?(console.error(y),console.error(l,u.target,p),[2,!1]):[4,_.delay(500)];case 6:return s.sent(),[4,this.isAssetTransferrable({asset:r,fromAddress:a,toAddress:o,quantity:i,useProxy:d},t-1)];case 7:return[2,s.sent()];case 8:return[2]}}))}))},e.prototype.transfer=function(e){var t=e.fromAddress,r=e.toAddress,a=e.asset,o=e.quantity,i=void 0===o?1:o;return n(this,void 0,void 0,(function(){var e,n,o,c,d,u,l,m,p=this;return s(this,(function(s){switch(s.label){case 0:return e=this._getSchema(a.schemaName),n=h.WyvernProtocol.toBaseUnitAmount(_.makeBigNumber(i),a.decimals||0),o=_.getWyvernAsset(e,a,n),c=[y.CK_ADDRESS,y.CK_RINKEBY_ADDRESS].includes(o.address),d=c||!!a.version&&[f.TokenStandardVersion.ERC721v1,f.TokenStandardVersion.ERC721v2].includes(a.version),u=a.schemaName===f.WyvernSchemaName.ERC20?_.annotateERC20TransferABI(o):d?_.annotateERC721TransferABI(o):e.functions.transfer(o),this._dispatch(f.EventType.TransferOne,{accountAddress:t,toAddress:r,asset:o}),l=g.encodeTransferCall(u,t,r),[4,_.sendRawTransaction(this.web3,{from:t,to:u.target,data:l},(function(e){p._dispatch(f.EventType.TransactionDenied,{error:e,accountAddress:t})}))];case 1:return m=s.sent(),[4,this._confirmTransaction(m,f.EventType.TransferOne,"Transferring asset")];case 2:return s.sent(),[2,m]}}))}))},e.prototype.transferAll=function(e){var t=e.assets,r=e.fromAddress,a=e.toAddress,o=e.schemaName,i=void 0===o?f.WyvernSchemaName.ERC721:o;return n(this,void 0,void 0,(function(){var e,n,o,c,d,u,l,h=this;return s(this,(function(s){switch(s.label){case 0:return a=_.validateAndFormatWalletAddress(this.web3,a),e=t.map((function(e){return e.schemaName||i})),n=t.map((function(e){return _.getWyvernAsset(h._getSchema(e.schemaName),e)})),o=g.encodeAtomicizedTransfer(e.map((function(e){return h._getSchema(e)})),n,r,a,this._wyvernProtocol,this._networkName),c=o.calldata,d=o.target,[4,this._getProxy(r)];case 1:return(u=s.sent())?[3,3]:[4,this._initializeProxy(r)];case 2:u=s.sent(),s.label=3;case 3:return[4,this._approveAll({schemaNames:e,wyAssets:n,accountAddress:r,proxyAddress:u})];case 4:return s.sent(),this._dispatch(f.EventType.TransferAll,{accountAddress:r,toAddress:a,assets:n}),[4,_.sendRawTransaction(this.web3,{from:r,to:u,data:g.encodeProxyCall(d,f.HowToCall.DelegateCall,c)},(function(e){h._dispatch(f.EventType.TransactionDenied,{error:e,accountAddress:r})}))];case 5:return l=s.sent(),[4,this._confirmTransaction(l,f.EventType.TransferAll,"Transferring "+t.length+" asset"+(1==t.length?"":"s"))];case 6:return s.sent(),[2,l]}}))}))},e.prototype.getFungibleTokens=function(e){var t=void 0===e?{}:e,r=t.symbol,a=t.address,i=t.name;return n(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(s){switch(s.label){case 0:return _.onDeprecated("Use `api.getPaymentTokens` instead"),e=m.tokens[this._networkName],[4,this.api.getPaymentTokens({symbol:r,address:a,name:i})];case 1:return t=s.sent().tokens,n=o([e.canonicalWrappedEther],e.otherTokens).filter((function(e){return(null==r||e.symbol.toLowerCase()==r.toLowerCase())&&((null==a||e.address.toLowerCase()==a.toLowerCase())&&(null==i||e.name==i))})),[2,o(o([],n),t)]}}))}))},e.prototype.getAssetBalance=function(e,t){var r=e.accountAddress,a=e.asset;return void 0===t&&(t=1),n(this,void 0,void 0,(function(){var e,n,c,d,u,l,h,m,p,y;return s(this,(function(s){switch(s.label){case 0:return e=this._getSchema(a.schemaName),n=_.getWyvernAsset(e,a),e.functions.countOf?(c=e.functions.countOf(n),d=this._getClientsForRead(t).web3.eth.contract([c]).at(c.target),u=c.inputs.filter((function(e){return void 0!==e.value})).map((function(e){return e.value})),[4,_.promisifyCall((function(e){var t;return(t=d[c.name]).call.apply(t,o(o([r],u),[e]))}))]):[3,2];case 1:return void 0!==(l=s.sent())?[2,l]:[3,5];case 2:if(!e.functions.ownerOf)return[3,4];if(h=e.functions.ownerOf(n),m=this._getClientsForRead(t).web3.eth.contract([h]).at(h.target),h.inputs.filter((function(e){return void 0===e.value}))[0])throw new Error("Missing an argument for finding the owner of this asset");return p=h.inputs.map((function(e){return e.value.toString()})),[4,_.promisifyCall((function(e){var t;return(t=m[h.name]).call.apply(t,o(o([],p),[e]))}))];case 3:return(y=s.sent())?[2,y.toLowerCase()==r.toLowerCase()?new i.BigNumber(1):new i.BigNumber(0)]:[3,5];case 4:throw new Error("Missing ownership schema for this asset type");case 5:if(!(t<=0))return[3,6];throw new Error("Unable to get current owner from smart contract");case 6:return[4,_.delay(500)];case 7:return s.sent(),[4,this.getAssetBalance({accountAddress:r,asset:a},t-1)];case 8:return[2,s.sent()]}}))}))},e.prototype.getTokenBalance=function(e,t){var r=e.accountAddress,a=e.tokenAddress,o=e.schemaName,i=void 0===o?f.WyvernSchemaName.ERC20:o;return void 0===t&&(t=1),n(this,void 0,void 0,(function(){var e;return s(this,(function(n){return e={tokenId:null,tokenAddress:a,schemaName:i},[2,this.getAssetBalance({accountAddress:r,asset:e},t)]}))}))},e.prototype.computeFees=function(e){var t=e.asset,r=e.side,a=e.accountAddress,o=e.extraBountyBasisPoints,i=void 0===o?0:o;return n(this,void 0,void 0,(function(){var e,n,o,c,d,u,l,h,m,p,v,A;return s(this,(function(s){switch(s.label){case 0:if(e=y.DEFAULT_BUYER_FEE_BASIS_POINTS,n=y.DEFAULT_SELLER_FEE_BASIS_POINTS,o=0,c=0,d=_.makeBigNumber(0),u=null,l=y.DEFAULT_MAX_BOUNTY,t&&(e=+t.collection.openseaBuyerFeeBasisPoints,n=+t.collection.openseaSellerFeeBasisPoints,o=+t.collection.devBuyerFeeBasisPoints,c=+t.collection.devSellerFeeBasisPoints,l=n),r!=f.OrderSide.Sell||!t)return[3,4];d=t.transferFee?_.makeBigNumber(t.transferFee):d,u=t.transferFeePaymentToken?t.transferFeePaymentToken.address:u,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,_.getTransferFeeSettings(this.web3,{asset:t,accountAddress:a})];case 2:return h=s.sent(),d=null!=h.transferFee?h.transferFee:d,u=h.transferFeeTokenAddress||u,[3,4];case 3:return m=s.sent(),console.error(m),[3,4];case 4:if(p=r==f.OrderSide.Sell?i:0,v=p+y.OPENSEA_SELLER_BOUNTY_BASIS_POINTS>l,p>0&&v)throw A="Total bounty exceeds the maximum for this asset type ("+l/100+"%).",l>=y.OPENSEA_SELLER_BOUNTY_BASIS_POINTS&&(A+=" Remember that OpenSea will add "+y.OPENSEA_SELLER_BOUNTY_BASIS_POINTS/100+"% for referrers with OpenSea accounts!"),new Error(A);return[2,{totalBuyerFeeBasisPoints:e+o,totalSellerFeeBasisPoints:n+c,openseaBuyerFeeBasisPoints:e,openseaSellerFeeBasisPoints:n,devBuyerFeeBasisPoints:o,devSellerFeeBasisPoints:c,sellerBountyBasisPoints:p,transferFee:d,transferFeeTokenAddress:u}]}}))}))},e.prototype.validateAndPostOrder=function(e){return n(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._wyvernProtocolReadOnly.wyvernExchange.hashOrder_.callAsync([e.exchange,e.maker,e.taker,e.feeRecipient,e.target,e.staticTarget,e.paymentToken],[e.makerRelayerFee,e.takerRelayerFee,e.makerProtocolFee,e.takerProtocolFee,e.basePrice,e.extra,e.listingTime,e.expirationTime,e.salt],e.feeMethod,e.side,e.saleKind,e.howToCall,e.calldata,e.replacementPattern,e.staticExtradata)];case 1:if(t.sent()!==e.hash)throw console.error(e),new Error("Order couldn't be validated by the exchange due to a hash mismatch. Make sure your wallet is on the right network!");return this.logger("Order hashes match"),[4,this.api.postOrder(_.orderToJSON(e))];case 2:return[2,t.sent()]}}))}))},e.prototype._computeGasPrice=function(){return n(this,void 0,void 0,(function(){var e,t;return s(this,(function(r){switch(r.label){case 0:return[4,_.getCurrentGasPrice(this.web3)];case 1:return e=r.sent(),t=this.web3.toWei(this.gasPriceAddition,"gwei"),[2,e.plus(t)]}}))}))},e.prototype._correctGasAmount=function(e){return Math.ceil(e*this.gasIncreaseFactor)},e.prototype._estimateGasForMatch=function(e,t){var r=e.buy,a=e.sell,o=e.accountAddress,i=e.metadata,c=void 0===i?y.NULL_BLOCK_HASH:i;return void 0===t&&(t=1),n(this,void 0,void 0,(function(){var e,n;return s(this,(function(s){switch(s.label){case 0:return r.maker.toLowerCase()!=o.toLowerCase()||r.paymentToken!=y.NULL_ADDRESS?[3,2]:[4,this._getRequiredAmountForTakingSellOrder(a)];case 1:e=s.sent(),s.label=2;case 2:return s.trys.push([2,4,,7]),[4,this._getClientsForRead(t).wyvernProtocol.wyvernExchange.atomicMatch_.estimateGasAsync([r.exchange,r.maker,r.taker,r.feeRecipient,r.target,r.staticTarget,r.paymentToken,a.exchange,a.maker,a.taker,a.feeRecipient,a.target,a.staticTarget,a.paymentToken],[r.makerRelayerFee,r.takerRelayerFee,r.makerProtocolFee,r.takerProtocolFee,r.basePrice,r.extra,r.listingTime,r.expirationTime,r.salt,a.makerRelayerFee,a.takerRelayerFee,a.makerProtocolFee,a.takerProtocolFee,a.basePrice,a.extra,a.listingTime,a.expirationTime,a.salt],[r.feeMethod,r.side,r.saleKind,r.howToCall,a.feeMethod,a.side,a.saleKind,a.howToCall],r.calldata,a.calldata,r.replacementPattern,a.replacementPattern,r.staticExtradata,a.staticExtradata,[r.v||0,a.v||0],[r.r||y.NULL_BLOCK_HASH,r.s||y.NULL_BLOCK_HASH,a.r||y.NULL_BLOCK_HASH,a.s||y.NULL_BLOCK_HASH,c],{from:o,value:e})];case 3:return[2,s.sent()];case 4:return n=s.sent(),t<=0?(console.error(n),[2,void 0]):[4,_.delay(200)];case 5:return s.sent(),[4,this._estimateGasForMatch({buy:r,sell:a,accountAddress:o,metadata:c},t-1)];case 6:return[2,s.sent()];case 7:return[2]}}))}))},e.prototype._estimateGasForTransfer=function(e){var t=e.assets,r=e.fromAddress,a=e.toAddress,o=e.schemaName,i=void 0===o?f.WyvernSchemaName.ERC721:o;return n(this,void 0,void 0,(function(){var e,n,o,c,d,u,l=this;return s(this,(function(s){switch(s.label){case 0:return e=t.map((function(e){return e.schemaName||i})),n=t.map((function(e){return _.getWyvernAsset(l._getSchema(e.schemaName),e)})),[4,this._getProxy(r)];case 1:if(!(o=s.sent()))throw new Error("Uninitialized proxy address");return[4,this._approveAll({schemaNames:e,wyAssets:n,accountAddress:r,proxyAddress:o})];case 2:return s.sent(),c=g.encodeAtomicizedTransfer(e.map((function(e){return l._getSchema(e)})),n,r,a,this._wyvernProtocol,this._networkName),d=c.calldata,u=c.target,[2,_.estimateGas(this.web3,{from:r,to:o,data:g.encodeProxyCall(u,f.HowToCall.DelegateCall,d)})]}}))}))},e.prototype._getProxy=function(e,t){return void 0===t&&(t=0),n(this,void 0,void 0,(function(){var r;return s(this,(function(a){switch(a.label){case 0:return[4,this._wyvernProtocolReadOnly.wyvernProxyRegistry.proxies.callAsync(e)];case 1:if("0x"==(r=a.sent()))throw new Error("Couldn't retrieve your account from the blockchain - make sure you're on the correct Ethereum network!");return r&&r!=y.NULL_ADDRESS?[3,5]:t>0?[4,_.delay(1e3)]:[3,4];case 2:return a.sent(),[4,this._getProxy(e,t-1)];case 3:return[2,a.sent()];case 4:r=null,a.label=5;case 5:return[2,r]}}))}))},e.prototype._initializeProxy=function(e){return n(this,void 0,void 0,(function(){var t,r,o,i,c=this;return s(this,(function(d){switch(d.label){case 0:return this._dispatch(f.EventType.InitializeAccount,{accountAddress:e}),this.logger("Initializing proxy for account: "+e),t={from:e},[4,this._wyvernProtocolReadOnly.wyvernProxyRegistry.registerProxy.estimateGasAsync(t)];case 1:return r=d.sent(),[4,this._wyvernProtocol.wyvernProxyRegistry.registerProxy.sendTransactionAsync(a(a({},t),{gas:this._correctGasAmount(r)}))];case 2:return o=d.sent(),[4,this._confirmTransaction(o,f.EventType.InitializeAccount,"Initializing proxy for account",(function(){return n(c,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._getProxy(e)];case 1:return[2,!!t.sent()]}}))}))}))];case 3:return d.sent(),[4,this._getProxy(e,10)];case 4:if(!(i=d.sent()))throw new Error("Failed to initialize your account :( Please restart your wallet/browser and try again!");return[2,i]}}))}))},e.prototype._getApprovedTokenCount=function(e){var t=e.accountAddress,r=e.tokenAddress,a=e.proxyAddress;return n(this,void 0,void 0,(function(){var e,n;return s(this,(function(s){switch(s.label){case 0:return r||(r=m.tokens[this._networkName].canonicalWrappedEther.address),e=a||h.WyvernProtocol.getTokenTransferProxyAddress(this._networkName),[4,_.rawCall(this.web3,{from:t,to:r,data:g.encodeCall(v.getMethod(v.ERC20,"allowance"),[t,e])})];case 1:return n=s.sent(),[2,_.makeBigNumber(n)]}}))}))},e.prototype._makeBuyOrder=function(e){var t=e.asset,r=e.quantity,a=e.accountAddress,o=e.startAmount,i=e.expirationTime,c=void 0===i?0:i,d=e.paymentTokenAddress,u=e.extraBountyBasisPoints,l=void 0===u?0:u,m=e.sellOrder,p=e.referrerAddress;return n(this,void 0,void 0,(function(){var e,n,i,u,v,A,w,T,k,E,b,P,S,N,F,R,B,x,C,O,L,D,I,W,M,U,H,q;return s(this,(function(s){switch(s.label){case 0:return a=_.validateAndFormatWalletAddress(this.web3,a),e=this._getSchema(t.schemaName),n=h.WyvernProtocol.toBaseUnitAmount(_.makeBigNumber(r),t.decimals||0),i=_.getWyvernAsset(e,t,n),[4,this.api.getAsset(t)];case 1:return u=s.sent(),v=m?m.maker:y.NULL_ADDRESS,[4,this.computeFees({asset:u,extraBountyBasisPoints:l,side:f.OrderSide.Buy})];case 2:return A=s.sent(),w=A.totalBuyerFeeBasisPoints,T=A.totalSellerFeeBasisPoints,k=this._getBuyFeeParameters(w,T,m),E=k.makerRelayerFee,b=k.takerRelayerFee,P=k.makerProtocolFee,S=k.takerProtocolFee,N=k.makerReferrerFee,F=k.feeRecipient,R=k.feeMethod,B=g.encodeBuy(e,i,a),x=B.target,C=B.calldata,O=B.replacementPattern,[4,this._getPriceParameters(f.OrderSide.Buy,d,c,o)];case 3:return L=s.sent(),D=L.basePrice,I=L.extra,W=L.paymentToken,M=this._getTimeParameters(c),[4,this._getStaticCallTargetAndExtraData({asset:u,useTxnOriginStaticCall:!1})];case 4:return U=s.sent(),H=U.staticTarget,q=U.staticExtradata,[2,{exchange:h.WyvernProtocol.getExchangeContractAddress(this._networkName),maker:a,taker:v,quantity:n,makerRelayerFee:E,takerRelayerFee:b,makerProtocolFee:P,takerProtocolFee:S,makerReferrerFee:N,waitingForBestCounterOrder:!1,feeMethod:R,feeRecipient:F,side:f.OrderSide.Buy,saleKind:f.SaleKind.FixedPrice,target:x,howToCall:f.HowToCall.Call,calldata:C,replacementPattern:O,staticTarget:H,staticExtradata:q,paymentToken:W,basePrice:D,extra:I,listingTime:M.listingTime,expirationTime:M.expirationTime,salt:h.WyvernProtocol.generatePseudoRandomSalt(),metadata:{asset:i,schema:e.name,referrerAddress:p}}]}}))}))},e.prototype._makeSellOrder=function(e){var t=e.asset,r=e.quantity,a=e.accountAddress,o=e.startAmount,i=e.endAmount,c=e.listingTime,d=e.expirationTime,u=e.waitForHighestBid,l=e.englishAuctionReservePrice,m=void 0===l?0:l,p=e.paymentTokenAddress,y=e.extraBountyBasisPoints,v=e.buyerAddress;return n(this,void 0,void 0,(function(){var e,n,l,A,w,T,k,E,b,P,S,N,F,R,B,x,C,O,L,D,I,W,M,U,H,q,K,z,Y,G;return s(this,(function(s){switch(s.label){case 0:return a=_.validateAndFormatWalletAddress(this.web3,a),e=this._getSchema(t.schemaName),n=h.WyvernProtocol.toBaseUnitAmount(_.makeBigNumber(r),t.decimals||0),l=_.getWyvernAsset(e,t,n),[4,this.api.getAsset(t)];case 1:return A=s.sent(),[4,this.computeFees({asset:A,side:f.OrderSide.Sell,extraBountyBasisPoints:y})];case 2:return w=s.sent(),T=w.totalSellerFeeBasisPoints,k=w.totalBuyerFeeBasisPoints,E=w.sellerBountyBasisPoints,b=g.encodeSell(e,l,a),P=b.target,S=b.calldata,N=b.replacementPattern,F=null!=i&&i!==o?f.SaleKind.DutchAuction:f.SaleKind.FixedPrice,[4,this._getPriceParameters(f.OrderSide.Sell,p,d,o,i,u,m)];case 3:return R=s.sent(),B=R.basePrice,x=R.extra,C=R.paymentToken,O=R.reservePrice,L=this._getTimeParameters(d,c,u),D=this._getSellFeeParameters(k,T,u,E),I=D.makerRelayerFee,W=D.takerRelayerFee,M=D.makerProtocolFee,U=D.takerProtocolFee,H=D.makerReferrerFee,q=D.feeRecipient,K=D.feeMethod,[4,this._getStaticCallTargetAndExtraData({asset:A,useTxnOriginStaticCall:u})];case 4:return z=s.sent(),Y=z.staticTarget,G=z.staticExtradata,[2,{exchange:h.WyvernProtocol.getExchangeContractAddress(this._networkName),maker:a,taker:v,quantity:n,makerRelayerFee:I,takerRelayerFee:W,makerProtocolFee:M,takerProtocolFee:U,makerReferrerFee:H,waitingForBestCounterOrder:u,englishAuctionReservePrice:O?_.makeBigNumber(O):void 0,feeMethod:K,feeRecipient:q,side:f.OrderSide.Sell,saleKind:F,target:P,howToCall:f.HowToCall.Call,calldata:S,replacementPattern:N,staticTarget:Y,staticExtradata:G,paymentToken:C,basePrice:B,extra:x,listingTime:L.listingTime,expirationTime:L.expirationTime,salt:h.WyvernProtocol.generatePseudoRandomSalt(),metadata:{asset:l,schema:e.name}}]}}))}))},e.prototype._getStaticCallTargetAndExtraData=function(e){var t=e.asset,r=e.useTxnOriginStaticCall;return n(this,void 0,void 0,(function(){var e,a,n,o,i,c,d,u,l;return s(this,(function(s){switch(s.label){case 0:return e=[y.CHEEZE_WIZARDS_GUILD_ADDRESS.toLowerCase(),y.CHEEZE_WIZARDS_GUILD_RINKEBY_ADDRESS.toLowerCase()].includes(t.tokenAddress.toLowerCase()),a=t.tokenAddress.toLowerCase()==y.DECENTRALAND_ESTATE_ADDRESS.toLowerCase(),(n=this._networkName==f.Network.Main)&&!r?[2,{staticTarget:y.NULL_ADDRESS,staticExtradata:"0x"}]:e?(o=n?y.CHEEZE_WIZARDS_BASIC_TOURNAMENT_ADDRESS:y.CHEEZE_WIZARDS_BASIC_TOURNAMENT_RINKEBY_ADDRESS,[4,this.web3.eth.contract(v.CheezeWizardsBasicTournament).at(o)]):[3,3];case 1:return i=s.sent(),[4,_.rawCall(this.web3,{to:i.address,data:i.wizardFingerprint.getData(t.tokenId)})];case 2:return c=s.sent(),[2,{staticTarget:n?y.STATIC_CALL_CHEEZE_WIZARDS_ADDRESS:y.STATIC_CALL_CHEEZE_WIZARDS_RINKEBY_ADDRESS,staticExtradata:g.encodeCall(v.getMethod(v.StaticCheckCheezeWizards,"succeedIfCurrentWizardFingerprintMatchesProvidedWizardFingerprint"),[t.tokenId,c,r])}];case 3:return a&&n?(d=y.DECENTRALAND_ESTATE_ADDRESS,[4,this.web3.eth.contract(v.DecentralandEstates).at(d)]):[3,6];case 4:return u=s.sent(),[4,_.rawCall(this.web3,{to:u.address,data:u.getFingerprint.getData(t.tokenId)})];case 5:return l=s.sent(),[2,{staticTarget:y.STATIC_CALL_DECENTRALAND_ESTATES_ADDRESS,staticExtradata:g.encodeCall(v.getMethod(v.StaticCheckDecentralandEstates,"succeedIfCurrentEstateFingerprintMatchesProvidedEstateFingerprint"),[t.tokenId,l,r])}];case 6:return r?[2,{staticTarget:n?y.STATIC_CALL_TX_ORIGIN_ADDRESS:y.STATIC_CALL_TX_ORIGIN_RINKEBY_ADDRESS,staticExtradata:g.encodeCall(v.getMethod(v.StaticCheckTxOrigin,"succeedIfTxOriginMatchesHardcodedAddress"),[])}]:[2,{staticTarget:y.NULL_ADDRESS,staticExtradata:"0x"}];case 7:return[2]}}))}))},e.prototype._makeBundleBuyOrder=function(e){var t=e.assets,r=e.collection,a=e.quantities,o=e.accountAddress,i=e.startAmount,c=e.expirationTime,d=void 0===c?0:c,u=e.paymentTokenAddress,l=e.extraBountyBasisPoints,m=void 0===l?0:l,p=e.sellOrder,v=e.referrerAddress;return n(this,void 0,void 0,(function(){var e,n,c,l,A,w,T,k,E,b,P,S,N,F,R,B,x,C,O,L,D,I,W,M,U,H=this;return s(this,(function(s){switch(s.label){case 0:return o=_.validateAndFormatWalletAddress(this.web3,o),e=a.map((function(e,r){return h.WyvernProtocol.toBaseUnitAmount(_.makeBigNumber(e),t[r].decimals||0)})),n=_.getWyvernBundle(t,t.map((function(e){return H._getSchema(e.schemaName)})),e),c=n.schemas.map((function(e){return H._getSchema(e)})),l=p?p.maker:y.NULL_ADDRESS,r?[4,this.api.getAsset(t[0])]:[3,2];case 1:return w=s.sent(),[3,3];case 2:w=void 0,s.label=3;case 3:return A=w,[4,this.computeFees({asset:A,extraBountyBasisPoints:m,side:f.OrderSide.Buy})];case 4:return T=s.sent(),k=T.totalBuyerFeeBasisPoints,E=T.totalSellerFeeBasisPoints,b=this._getBuyFeeParameters(k,E,p),P=b.makerRelayerFee,S=b.takerRelayerFee,N=b.makerProtocolFee,F=b.takerProtocolFee,R=b.makerReferrerFee,B=b.feeRecipient,x=b.feeMethod,C=g.encodeAtomicizedBuy(c,n.assets,o,this._wyvernProtocol,this._networkName),O=C.calldata,L=C.replacementPattern,[4,this._getPriceParameters(f.OrderSide.Buy,u,d,i)];case 5:return D=s.sent(),I=D.basePrice,W=D.extra,M=D.paymentToken,U=this._getTimeParameters(d),[2,{exchange:h.WyvernProtocol.getExchangeContractAddress(this._networkName),maker:o,taker:l,quantity:_.makeBigNumber(1),makerRelayerFee:P,takerRelayerFee:S,makerProtocolFee:N,takerProtocolFee:F,makerReferrerFee:R,waitingForBestCounterOrder:!1,feeMethod:x,feeRecipient:B,side:f.OrderSide.Buy,saleKind:f.SaleKind.FixedPrice,target:h.WyvernProtocol.getAtomicizerContractAddress(this._networkName),howToCall:f.HowToCall.DelegateCall,calldata:O,replacementPattern:L,staticTarget:y.NULL_ADDRESS,staticExtradata:"0x",paymentToken:M,basePrice:I,extra:W,listingTime:U.listingTime,expirationTime:U.expirationTime,salt:h.WyvernProtocol.generatePseudoRandomSalt(),metadata:{bundle:n,referrerAddress:v}}]}}))}))},e.prototype._makeBundleSellOrder=function(e){var t=e.bundleName,r=e.bundleDescription,a=e.bundleExternalLink,o=e.assets,i=e.collection,c=e.quantities,d=e.accountAddress,u=e.startAmount,l=e.endAmount,m=e.listingTime,p=e.expirationTime,v=e.waitForHighestBid,A=e.englishAuctionReservePrice,w=void 0===A?0:A,T=e.paymentTokenAddress,k=e.extraBountyBasisPoints,E=e.buyerAddress;return n(this,void 0,void 0,(function(){var e,n,A,b,P,S,N,F,R,B,x,C,O,L,D,I,W,M,U,H,q,K,z,Y,G,V,Z=this;return s(this,(function(s){switch(s.label){case 0:return d=_.validateAndFormatWalletAddress(this.web3,d),e=c.map((function(e,t){return h.WyvernProtocol.toBaseUnitAmount(_.makeBigNumber(e),o[t].decimals||0)})),n=_.getWyvernBundle(o,o.map((function(e){return Z._getSchema(e.schemaName)})),e),A=n.schemas.map((function(e){return Z._getSchema(e)})),n.name=t,n.description=r,n.external_link=a,i?[4,this.api.getAsset(o[0])]:[3,2];case 1:return P=s.sent(),[3,3];case 2:P=void 0,s.label=3;case 3:return b=P,[4,this.computeFees({asset:b,side:f.OrderSide.Sell,extraBountyBasisPoints:k})];case 4:return S=s.sent(),N=S.totalSellerFeeBasisPoints,F=S.totalBuyerFeeBasisPoints,R=S.sellerBountyBasisPoints,B=g.encodeAtomicizedSell(A,n.assets,d,this._wyvernProtocol,this._networkName),x=B.calldata,C=B.replacementPattern,[4,this._getPriceParameters(f.OrderSide.Sell,T,p,u,l,v,w)];case 5:return O=s.sent(),L=O.basePrice,D=O.extra,I=O.paymentToken,W=O.reservePrice,M=this._getTimeParameters(p,m,v),U=null!=l&&l!==u?f.SaleKind.DutchAuction:f.SaleKind.FixedPrice,H=this._getSellFeeParameters(F,N,v,R),q=H.makerRelayerFee,K=H.takerRelayerFee,z=H.makerProtocolFee,Y=H.takerProtocolFee,G=H.makerReferrerFee,V=H.feeRecipient,[2,{exchange:h.WyvernProtocol.getExchangeContractAddress(this._networkName),maker:d,taker:E,quantity:_.makeBigNumber(1),makerRelayerFee:q,takerRelayerFee:K,makerProtocolFee:z,takerProtocolFee:Y,makerReferrerFee:G,waitingForBestCounterOrder:v,englishAuctionReservePrice:W?_.makeBigNumber(W):void 0,feeMethod:f.FeeMethod.SplitFee,feeRecipient:V,side:f.OrderSide.Sell,saleKind:U,target:h.WyvernProtocol.getAtomicizerContractAddress(this._networkName),howToCall:f.HowToCall.DelegateCall,calldata:x,replacementPattern:C,staticTarget:y.NULL_ADDRESS,staticExtradata:"0x",paymentToken:I,basePrice:L,extra:D,listingTime:M.listingTime,expirationTime:M.expirationTime,salt:h.WyvernProtocol.generatePseudoRandomSalt(),metadata:{bundle:n}}]}}))}))},e.prototype._makeMatchingOrder=function(e){var t=this,r=e.order,n=e.accountAddress,s=e.recipientAddress;n=_.validateAndFormatWalletAddress(this.web3,n),s=_.validateAndFormatWalletAddress(this.web3,s);var o=function(){if("asset"in r.metadata){var e=t._getSchema(r.metadata.schema);return r.side==f.OrderSide.Buy?g.encodeSell(e,r.metadata.asset,s):g.encodeBuy(e,r.metadata.asset,s)}if("bundle"in r.metadata){var a=r.metadata.bundle,n=a.schemas?a.schemas.map((function(e){return t._getSchema(e)})):a.assets.map((function(){return t._getSchema("schema"in r.metadata?r.metadata.schema:void 0)})),o=r.side==f.OrderSide.Buy?g.encodeAtomicizedSell(n,r.metadata.bundle.assets,s,t._wyvernProtocol,t._networkName):g.encodeAtomicizedBuy(n,r.metadata.bundle.assets,s,t._wyvernProtocol,t._networkName);return{target:h.WyvernProtocol.getAtomicizerContractAddress(t._networkName),calldata:o.calldata,replacementPattern:o.replacementPattern}}throw new Error("Invalid order metadata")}(),i=o.target,c=o.calldata,d=o.replacementPattern,u=this._getTimeParameters(0),l=r.feeRecipient==y.NULL_ADDRESS?y.OPENSEA_FEE_RECIPIENT:y.NULL_ADDRESS,m={exchange:r.exchange,maker:n,taker:r.maker,quantity:r.quantity,makerRelayerFee:r.makerRelayerFee,takerRelayerFee:r.takerRelayerFee,makerProtocolFee:r.makerProtocolFee,takerProtocolFee:r.takerProtocolFee,makerReferrerFee:r.makerReferrerFee,waitingForBestCounterOrder:!1,feeMethod:r.feeMethod,feeRecipient:l,side:(r.side+1)%2,saleKind:f.SaleKind.FixedPrice,target:i,howToCall:r.howToCall,calldata:c,replacementPattern:d,staticTarget:y.NULL_ADDRESS,staticExtradata:"0x",paymentToken:r.paymentToken,basePrice:r.basePrice,extra:_.makeBigNumber(0),listingTime:u.listingTime,expirationTime:u.expirationTime,salt:h.WyvernProtocol.generatePseudoRandomSalt(),metadata:r.metadata};return a(a({},m),{hash:_.getOrderHash(m)})},e.prototype._validateMatch=function(e,t){var r=e.buy,a=e.sell,o=e.accountAddress,i=e.shouldValidateBuy,c=void 0!==i&&i,d=e.shouldValidateSell,u=void 0!==d&&d;return void 0===t&&(t=1),n(this,void 0,void 0,(function(){var e,n,i,d,l;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,7,,10]),c?[4,this._validateOrder(r)]:[3,2];case 1:if(e=s.sent(),this.logger("Buy order is valid: "+e),!e)throw new Error("Invalid buy order. It may have recently been removed. Please refresh the page and try again!");s.label=2;case 2:return u?[4,this._validateOrder(a)]:[3,4];case 3:if(n=s.sent(),this.logger("Sell order is valid: "+n),!n)throw new Error("Invalid sell order. It may have recently been removed. Please refresh the page and try again!");s.label=4;case 4:return[4,A.requireOrdersCanMatch(this._getClientsForRead(t).wyvernProtocol,{buy:r,sell:a,accountAddress:o})];case 5:return i=s.sent(),this.logger("Orders matching: "+i),[4,A.requireOrderCalldataCanMatch(this._getClientsForRead(t).wyvernProtocol,{buy:r,sell:a})];case 6:return d=s.sent(),this.logger("Order calldata matching: "+d),[2,!0];case 7:if(l=s.sent(),t<=0)throw new Error("Error matching this listing: "+l.message+". Please contact the maker or try again later!");return[4,_.delay(500)];case 8:return s.sent(),[4,this._validateMatch({buy:r,sell:a,accountAddress:o,shouldValidateBuy:c,shouldValidateSell:u},t-1)];case 9:return[2,s.sent()];case 10:return[2]}}))}))},e.prototype._createEmailWhitelistEntry=function(e){var t=e.order,r=e.buyerEmail;return n(this,void 0,void 0,(function(){var e;return s(this,(function(a){switch(a.label){case 0:if(!(e="asset"in t.metadata?t.metadata.asset:void 0)||!e.id)throw new Error("Whitelisting only available for non-fungible assets.");return[4,this.api.postAssetWhitelist(e.address,e.id,r)];case 1:return a.sent(),[2]}}))}))},e.prototype._sellOrderValidationAndApprovals=function(e){var t=e.order,r=e.accountAddress;return n(this,void 0,void 0,(function(){var e,a,n,o;return s(this,(function(s){switch(s.label){case 0:return e="bundle"in t.metadata?t.metadata.bundle.assets:t.metadata.asset?[t.metadata.asset]:[],a="bundle"in t.metadata&&"schemas"in t.metadata.bundle?t.metadata.bundle.schemas:"schema"in t.metadata?[t.metadata.schema]:[],n=t.paymentToken,[4,this._approveAll({schemaNames:a,wyAssets:e,accountAddress:r})];case 1:return s.sent(),n==y.NULL_ADDRESS?[3,3]:(o=_.makeBigNumber(t.basePrice),[4,this.approveFungibleToken({accountAddress:r,tokenAddress:n,minimumAmount:o})]);case 2:s.sent(),s.label=3;case 3:return[4,this._wyvernProtocolReadOnly.wyvernExchange.validateOrderParameters_.callAsync([t.exchange,t.maker,t.taker,t.feeRecipient,t.target,t.staticTarget,t.paymentToken],[t.makerRelayerFee,t.takerRelayerFee,t.makerProtocolFee,t.takerProtocolFee,t.basePrice,t.extra,t.listingTime,t.expirationTime,t.salt],t.feeMethod,t.side,t.saleKind,t.howToCall,t.calldata,t.replacementPattern,t.staticExtradata,{from:r})];case 4:if(!s.sent())throw console.error(t),new Error("Failed to validate sell order parameters. Make sure you're on the right network!");return[2]}}))}))},e.prototype._approveOrder=function(e){return n(this,void 0,void 0,(function(){var t,r,a=this;return s(this,(function(o){switch(o.label){case 0:return t=e.maker,!0,this._dispatch(f.EventType.ApproveOrder,{order:e,accountAddress:t}),[4,this._wyvernProtocol.wyvernExchange.approveOrder_.sendTransactionAsync([e.exchange,e.maker,e.taker,e.feeRecipient,e.target,e.staticTarget,e.paymentToken],[e.makerRelayerFee,e.takerRelayerFee,e.makerProtocolFee,e.takerProtocolFee,e.basePrice,e.extra,e.listingTime,e.expirationTime,e.salt],e.feeMethod,e.side,e.saleKind,e.howToCall,e.calldata,e.replacementPattern,e.staticExtradata,true,{from:t})];case 1:return r=o.sent(),[4,this._confirmTransaction(r.toString(),f.EventType.ApproveOrder,"Approving order",(function(){return n(a,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._validateOrder(e)];case 1:return[2,t.sent()]}}))}))}))];case 2:return o.sent(),[2,r]}}))}))},e.prototype._validateOrder=function(e){return n(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._wyvernProtocolReadOnly.wyvernExchange.validateOrder_.callAsync([e.exchange,e.maker,e.taker,e.feeRecipient,e.target,e.staticTarget,e.paymentToken],[e.makerRelayerFee,e.takerRelayerFee,e.makerProtocolFee,e.takerProtocolFee,e.basePrice,e.extra,e.listingTime,e.expirationTime,e.salt],e.feeMethod,e.side,e.saleKind,e.howToCall,e.calldata,e.replacementPattern,e.staticExtradata,e.v||0,e.r||y.NULL_BLOCK_HASH,e.s||y.NULL_BLOCK_HASH)];case 1:return[2,t.sent()]}}))}))},e.prototype._approveAll=function(e){var t=e.schemaNames,r=e.wyAssets,a=e.accountAddress,o=e.proxyAddress;return n(this,void 0,void 0,(function(){var e,i,c=this;return s(this,(function(d){switch(d.label){case 0:return(e=o)?[3,2]:[4,this._getProxy(a)];case 1:e=d.sent(),d.label=2;case 2:return(o=e||void 0)?[3,4]:[4,this._initializeProxy(a)];case 3:o=d.sent(),d.label=4;case 4:return i=new Set,[2,Promise.all(r.map((function(e,r){return n(c,void 0,void 0,(function(){var n,c,d,u,l;return s(this,(function(s){switch(s.label){case 0:n=t[r],s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._ownsAssetOnChain({accountAddress:a,proxyAddress:o,wyAsset:e,schemaName:n})];case 2:return c=s.sent(),[3,4];case 3:return s.sent(),c=!0,[3,4];case 4:if(!c)throw d="quantity"in e?e.quantity:1,console.error("Failed on-chain ownership check: "+a+" on "+n+":",e),new Error("You don't own enough to do that ("+d+" base units of "+e.address+(e.id?" token "+e.id:"")+")");switch(n){case f.WyvernSchemaName.ERC721:case f.WyvernSchemaName.ERC721v3:case f.WyvernSchemaName.ERC1155:case f.WyvernSchemaName.LegacyEnjin:case f.WyvernSchemaName.ENSShortNameAuction:return[3,5];case f.WyvernSchemaName.ERC20:return[3,7]}return[3,9];case 5:return u=e,[4,this.approveSemiOrNonFungibleToken({tokenId:u.id.toString(),tokenAddress:u.address,accountAddress:a,proxyAddress:o,schemaName:n,skipApproveAllIfTokenAddressIn:i})];case 6:return[2,s.sent()];case 7:return l=e,i.has(l.address)?[2,null]:(i.add(l.address),[4,this.approveFungibleToken({tokenAddress:l.address,accountAddress:a,proxyAddress:o})]);case 8:return[2,s.sent()];case 9:return[2]}}))}))})))]}}))}))},e.prototype._buyOrderValidationAndApprovals=function(e){var t=e.order,r=e.counterOrder,a=e.accountAddress;return n(this,void 0,void 0,(function(){var e,n,o;return s(this,(function(s){switch(s.label){case 0:return(e=t.paymentToken)==y.NULL_ADDRESS?[3,5]:[4,this.getTokenBalance({accountAddress:a,tokenAddress:e})];case 1:return n=s.sent(),o=_.makeBigNumber(t.basePrice),r?[4,this._getRequiredAmountForTakingSellOrder(r)]:[3,3];case 2:o=s.sent(),s.label=3;case 3:if(n.toNumber()<o.toNumber())throw e==m.tokens[this._networkName].canonicalWrappedEther.address?new Error("Insufficient balance. You may need to wrap Ether."):new Error("Insufficient balance.");return[4,this.approveFungibleToken({accountAddress:a,tokenAddress:e,minimumAmount:o})];case 4:s.sent(),s.label=5;case 5:return[4,this._wyvernProtocolReadOnly.wyvernExchange.validateOrderParameters_.callAsync([t.exchange,t.maker,t.taker,t.feeRecipient,t.target,t.staticTarget,t.paymentToken],[t.makerRelayerFee,t.takerRelayerFee,t.makerProtocolFee,t.takerProtocolFee,t.basePrice,t.extra,t.listingTime,t.expirationTime,t.salt],t.feeMethod,t.side,t.saleKind,t.howToCall,t.calldata,t.replacementPattern,t.staticExtradata,{from:a})];case 6:if(!s.sent())throw console.error(t),new Error("Failed to validate buy order parameters. Make sure you're on the right network!");return[2]}}))}))},e.prototype._ownsAssetOnChain=function(e){var t=e.accountAddress,r=e.proxyAddress,a=e.wyAsset,o=e.schemaName;return n(this,void 0,void 0,(function(){var e,n,c;return s(this,(function(s){switch(s.label){case 0:return e={tokenId:a.id||null,tokenAddress:a.address,schemaName:o},n=new i.BigNumber("quantity"in a?a.quantity:1),[4,this.getAssetBalance({accountAddress:t,asset:e})];case 1:return s.sent().greaterThanOrEqualTo(n)?[2,!0]:(c=r)?[3,3]:[4,this._getProxy(t)];case 2:c=s.sent(),s.label=3;case 3:return(r=c)?[4,this.getAssetBalance({accountAddress:r,asset:e})]:[3,5];case 4:if(s.sent().greaterThanOrEqualTo(n))return[2,!0];s.label=5;case 5:return[2,!1]}}))}))},e.prototype._getBuyFeeParameters=function(e,t,r){var a,n;return this._validateFees(e,t),r?(a=r.waitingForBestCounterOrder?_.makeBigNumber(r.makerRelayerFee):_.makeBigNumber(r.takerRelayerFee),n=r.waitingForBestCounterOrder?_.makeBigNumber(r.takerRelayerFee):_.makeBigNumber(r.makerRelayerFee)):(a=_.makeBigNumber(e),n=_.makeBigNumber(t)),{makerRelayerFee:a,takerRelayerFee:n,makerProtocolFee:_.makeBigNumber(0),takerProtocolFee:_.makeBigNumber(0),makerReferrerFee:_.makeBigNumber(0),feeRecipient:y.OPENSEA_FEE_RECIPIENT,feeMethod:f.FeeMethod.SplitFee}},e.prototype._getSellFeeParameters=function(e,t,r,a){void 0===a&&(a=0),this._validateFees(e,t);var n=r?y.NULL_ADDRESS:y.OPENSEA_FEE_RECIPIENT;return{makerRelayerFee:r?_.makeBigNumber(e):_.makeBigNumber(t),takerRelayerFee:r?_.makeBigNumber(t):_.makeBigNumber(e),makerProtocolFee:_.makeBigNumber(0),takerProtocolFee:_.makeBigNumber(0),makerReferrerFee:_.makeBigNumber(a),feeRecipient:n,feeMethod:f.FeeMethod.SplitFee}},e.prototype._validateFees=function(e,t){var r=y.INVERSE_BASIS_POINT/100;if(e>y.INVERSE_BASIS_POINT||t>y.INVERSE_BASIS_POINT)throw new Error("Invalid buyer/seller fees: must be less than "+r+"%");if(e<0||t<0)throw new Error("Invalid buyer/seller fees: must be at least 0%")},e.prototype._getTimeParameters=function(e,t,r){void 0===r&&(r=!1);var a=Math.round(Date.now()/1e3+y.MIN_EXPIRATION_SECONDS),n=Math.round(Date.now()/1e3);if(0!=e&&e<a)throw new Error("Expiration time must be at least "+y.MIN_EXPIRATION_SECONDS+" seconds from now, or zero (non-expiring).");if(t&&t<n)throw new Error("Listing time cannot be in the past.");if(t&&0!=e&&t>=e)throw new Error("Listing time must be before the expiration time.");if(r&&0==e)throw new Error("English auctions must have an expiration time.");if(r&&t)throw new Error("Cannot schedule an English auction for the future.");if(parseInt(e.toString())!=e)throw new Error("Expiration timestamp must be a whole number of seconds");return r?(t=e,e+=y.ORDER_MATCHING_LATENCY_SECONDS):t=t||Math.round(Date.now()/1e3-100),{listingTime:_.makeBigNumber(t),expirationTime:_.makeBigNumber(e)}},e.prototype._getPriceParameters=function(e,t,r,a,o,i,c){return void 0===i&&(i=!1),n(this,void 0,void 0,(function(){var n,d,u,l,m,p,v,A;return s(this,(function(s){switch(s.label){case 0:return n=null!=o?a-o:0,d=t.toLowerCase(),u=t==y.NULL_ADDRESS,[4,this.api.getPaymentTokens({address:d})];case 1:if(l=s.sent().tokens,m=l[0],isNaN(a)||null==a||a<0)throw new Error("Starting price must be a number >= 0");if(!u&&!m)throw new Error("No ERC-20 token found for '"+d+"'");if(u&&i)throw new Error("English auctions must use wrapped ETH or an ERC-20 token.");if(u&&e===f.OrderSide.Buy)throw new Error("Offers must use wrapped ETH or an ERC-20 token.");if(n<0)throw new Error("End price must be less than or equal to the start price.");if(n>0&&0==r)throw new Error("Expiration time must be set if order will change in price.");if(c&&!i)throw new Error("Reserve prices may only be set on English auctions.");if(c&&c<a)throw new Error("Reserve price must be greater than or equal to the start amount.");return p=u?_.makeBigNumber(this.web3.toWei(a,"ether")).round():h.WyvernProtocol.toBaseUnitAmount(_.makeBigNumber(a),m.decimals),v=u?_.makeBigNumber(this.web3.toWei(n,"ether")).round():h.WyvernProtocol.toBaseUnitAmount(_.makeBigNumber(n),m.decimals),A=c?u?_.makeBigNumber(this.web3.toWei(c,"ether")).round():h.WyvernProtocol.toBaseUnitAmount(_.makeBigNumber(c),m.decimals):void 0,[2,{basePrice:p,extra:v,paymentToken:d,reservePrice:A}]}}))}))},e.prototype._getMetadata=function(e,t){var r=t||e.metadata.referrerAddress;if(r&&c.isValidAddress(r))return r},e.prototype._atomicMatch=function(e){var t=e.buy,r=e.sell,a=e.accountAddress,o=e.metadata,i=void 0===o?y.NULL_BLOCK_HASH:o;return n(this,void 0,void 0,(function(){var e,n,o,c,d,u,l,h,m;return s(this,(function(s){switch(s.label){case 0:return n=!0,o=!0,r.maker.toLowerCase()!=a.toLowerCase()?[3,2]:[4,this._sellOrderValidationAndApprovals({order:r,accountAddress:a})];case 1:return s.sent(),o=!1,[3,6];case 2:return t.maker.toLowerCase()!=a.toLowerCase()?[3,6]:[4,this._buyOrderValidationAndApprovals({order:t,counterOrder:r,accountAddress:a})];case 3:return s.sent(),n=!1,t.paymentToken!=y.NULL_ADDRESS?[3,5]:[4,this._getRequiredAmountForTakingSellOrder(r)];case 4:e=s.sent(),s.label=5;case 5:return[3,6];case 6:return[4,this._validateMatch({buy:t,sell:r,accountAddress:a,shouldValidateBuy:n,shouldValidateSell:o})];case 7:s.sent(),this._dispatch(f.EventType.MatchOrders,{buy:t,sell:r,accountAddress:a,matchMetadata:i}),d={from:a,value:e},u=[[t.exchange,t.maker,t.taker,t.feeRecipient,t.target,t.staticTarget,t.paymentToken,r.exchange,r.maker,r.taker,r.feeRecipient,r.target,r.staticTarget,r.paymentToken],[t.makerRelayerFee,t.takerRelayerFee,t.makerProtocolFee,t.takerProtocolFee,t.basePrice,t.extra,t.listingTime,t.expirationTime,t.salt,r.makerRelayerFee,r.takerRelayerFee,r.makerProtocolFee,r.takerProtocolFee,r.basePrice,r.extra,r.listingTime,r.expirationTime,r.salt],[t.feeMethod,t.side,t.saleKind,t.howToCall,r.feeMethod,r.side,r.saleKind,r.howToCall],t.calldata,r.calldata,t.replacementPattern,r.replacementPattern,t.staticExtradata,r.staticExtradata,[t.v||0,r.v||0],[t.r||y.NULL_BLOCK_HASH,t.s||y.NULL_BLOCK_HASH,r.r||y.NULL_BLOCK_HASH,r.s||y.NULL_BLOCK_HASH,i]],s.label=8;case 8:return s.trys.push([8,10,,11]),[4,this._wyvernProtocolReadOnly.wyvernExchange.atomicMatch_.estimateGasAsync(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8],u[9],u[10],d)];case 9:return l=s.sent(),d.gas=this._correctGasAmount(l),[3,11];case 10:throw h=s.sent(),console.error("Failed atomic match with args: ",u,h),new Error('Oops, the Ethereum network rejected this transaction :( The OpenSea devs have been alerted, but this problem is typically due an item being locked or untransferrable. The exact error was "'+h.message.substr(0,A.MAX_ERROR_LENGTH)+'..."');case 11:return s.trys.push([11,13,,14]),this.logger("Fulfilling order with gas set to "+d.gas),[4,this._wyvernProtocol.wyvernExchange.atomicMatch_.sendTransactionAsync(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8],u[9],u[10],d)];case 12:return c=s.sent(),[3,14];case 13:throw m=s.sent(),console.error(m),this._dispatch(f.EventType.TransactionDenied,{error:m,buy:t,sell:r,accountAddress:a,matchMetadata:i}),new Error('Failed to authorize transaction: "'+(m.message?m.message:"user denied")+'..."');case 14:return[2,c]}}))}))},e.prototype._getRequiredAmountForTakingSellOrder=function(e){return n(this,void 0,void 0,(function(){var t,r,a,n;return s(this,(function(s){switch(s.label){case 0:return[4,this.getCurrentPrice(e)];case 1:return t=s.sent(),r=_.estimateCurrentPrice(e),a=i.BigNumber.max(t,r),e.takerRelayerFee=_.makeBigNumber(e.takerRelayerFee),n=e.takerRelayerFee.div(y.INVERSE_BASIS_POINT),[2,n.times(a).plus(a).ceil()]}}))}))},e.prototype._authorizeOrder=function(e){return n(this,void 0,void 0,(function(){var t,r,a,n;return s(this,(function(s){switch(s.label){case 0:return t=e.hash,r=e.maker,this._dispatch(f.EventType.CreateOrder,{order:e,accountAddress:e.maker}),[4,_.isContractAddress(this.web3,r)];case 1:a=s.sent(),s.label=2;case 2:return s.trys.push([2,7,,8]),a?[4,this._approveOrder(e)]:[3,4];case 3:return s.sent(),[2,null];case 4:return[4,_.personalSignAsync(this.web3,t,r)];case 5:return[2,s.sent()];case 6:return[3,8];case 7:throw n=s.sent(),this._dispatch(f.EventType.OrderDenied,{order:e,accountAddress:r}),n;case 8:return[2]}}))}))},e.prototype._getSchema=function(e){var t=e||f.WyvernSchemaName.ERC721,r=m.schemas[this._networkName].filter((function(e){return e.name==t}))[0];if(!r)throw new Error("Trading for this asset ("+t+") is not yet supported. Please contact us or check back later!");return r},e.prototype._dispatch=function(e,t){this._emitter.emit(e,t)},e.prototype._getClientsForRead=function(e){return void 0===e&&(e=1),e>0?{web3:this.web3,wyvernProtocol:this._wyvernProtocol}:{web3:this.web3ReadOnly,wyvernProtocol:this._wyvernProtocolReadOnly}},e.prototype._confirmTransaction=function(e,t,r,o){return n(this,void 0,void 0,(function(){var n,i;return s(this,(function(s){switch(s.label){case 0:return n={transactionHash:e,event:t},this.logger("Transaction started: "+r),e!=y.NULL_BLOCK_HASH?[3,4]:(this._dispatch(f.EventType.TransactionCreated,{event:t}),o?[3,2]:(this.logger("Unknown action, waiting 1 minute: "+r),[4,_.delay(6e4)]));case 1:return s.sent(),[2];case 2:return[4,this._pollCallbackForConfirmation(t,r,o)];case 3:return[2,s.sent()];case 4:return s.trys.push([4,6,,7]),this._dispatch(f.EventType.TransactionCreated,n),[4,_.confirmTransaction(this.web3,e)];case 5:return s.sent(),this.logger("Transaction succeeded: "+r),this._dispatch(f.EventType.TransactionConfirmed,n),[3,7];case 6:throw i=s.sent(),this.logger("Transaction failed: "+r),this._dispatch(f.EventType.TransactionFailed,a(a({},n),{error:i})),i;case 7:return[2]}}))}))},e.prototype._pollCallbackForConfirmation=function(e,t,r){return n(this,void 0,void 0,(function(){var a=this;return s(this,(function(o){return[2,new Promise((function(o,i){return n(a,void 0,void 0,(function(){var a,c=this;return s(this,(function(d){return 60,[2,(a=function(d){return n(c,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,r()];case 1:return n.sent()?(this.logger("Transaction succeeded: "+t),this._dispatch(f.EventType.TransactionConfirmed,{event:e}),[2,o()]):d<=0?[2,i()]:(d%10==0&&this.logger("Tested transaction "+(60-d+1)+" times: "+t),[4,_.delay(5e3)]);case 2:return n.sent(),[2,a(d-1)]}}))}))})(60)]}))}))}))]}))}))},e}();t.OpenSeaPort=w}}]);